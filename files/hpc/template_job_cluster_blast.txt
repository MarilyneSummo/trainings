#!/bin/sh


############      SGE CONFIGURATION      ###################
# Write errors in the standard output file
#$ -j y 

# Shell to use
#$ -S /bin/bash

 #$ -b Y


# Mail to follow the exection of the job
#$ -M firstname.name@ird.fr           ######### change with your own email address

# Type of message to receive
#    -  (b) begining of the job
#    -  (e) end of the job
#    -  (a)  in case of abortion
#$ -m bea 

# Queue to use
#$ -q bioinfo.q
# To use serveral cores until 2
#$ -pe ompi 2
# Name of the job
#$ -N test_blast_tando 
############################################################

### change the following values with yours 
path_to_dir="/data/projects/tp-cluster/training_2019/Blast";
path_to_tmp="/scratch/tando_$JOB_ID"; 
path_to_dest="/home/tando";

############# load blast 2.4.0+ environment
module load bioinfo/blast/2.4.0+


 
###### Creation of a temporary folder on the chosen node
mkdir $path_to_tmp

####### Data copy to  the /scratch of the node
scp -r nas2:$path_to_dir $path_to_tmp # choose nas for /home, /data2 and /teams or nas2 for /data or nas3 pfor /data3
echo "Data transfer master -> noeud";
cd $path_to_tmp/Blast/;

###### Program execution
cmd="blastn -db All-EST-coffea.fasta -query  sequence-NMT.fasta -num_threads $NSLOTS  -out blastntando.out"; 
echo "Executed command: $cmd";
$cmd;




##### Data transfer from node to nas
scp -rp $path_to_tmp/Blast/blastntando.out  nas:$path_to_dest/;
echo "Data transfer node -> nas";

#### Deletion of the temporary folder in the /scratch of the node
#rm -rf $path_to_tmp;
echo "Data deletion on node";
